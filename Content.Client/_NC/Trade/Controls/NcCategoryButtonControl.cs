using System;
using Robust.Client.AutoGenerated;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Maths;

namespace Content.Client._NC.Trade.Controls;

[GenerateTypedNameReferences]
public sealed partial class NcCategoryButtonControl : Button
{
    private static readonly Color SelectedColor = new(0xD9, 0xA4, 0x41);
    private static readonly Color IdleColor = new(0x7C, 0x66, 0x24);

    public string CategoryId { get; private set; } = string.Empty;

    public event Action<string>? OnCategoryPressed;

    public NcCategoryButtonControl()
    {
        RobustXamlLoader.Load(this);

        OnMouseEntered += _ =>
        {
            ModulateSelfOverride = Pressed
                ? Brighten(SelectedColor, 1.2f)
                : Brighten(IdleColor, 1.2f);
        };

        OnMouseExited += _ =>
        {
            ModulateSelfOverride = Pressed ? SelectedColor : IdleColor;
        };

        OnPressed += _ =>
        {
            OnCategoryPressed?.Invoke(CategoryId);
        };
    }

    public void Bind(string categoryId, string text, string? tooltip)
    {
        CategoryId = categoryId;
        Text = text;
        ToolTip = tooltip;
    }

    public void SetSelected(bool selected)
    {
        if (Pressed != selected)
            Pressed = selected;

        ModulateSelfOverride = selected ? SelectedColor : IdleColor;
    }

    private static Color Brighten(Color c, float f) =>
        new(MathF.Min(c.R * f, 1f), MathF.Min(c.G * f, 1f), MathF.Min(c.B * f, 1f), c.A);
}
